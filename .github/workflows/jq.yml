name: jq on Ubuntu 20.04

on:
  workflow_dispatch:

jobs:
  download-dependencies:
    runs-on: ubuntu-latest # Runner 本身可以用最新的，关键是下面 Docker 用什么
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download dependencies for Ubuntu 20.04
        run: |
          echo "准备下载目录..."
          mkdir -p ./offline-packages
          # 修改权限确保 Docker 容器内可以写入
          chmod 777 ./offline-packages

          echo "启动 Ubuntu 20.04 容器进行下载..."
          # 关键点：这里指定镜像为 ubuntu:20.04
          docker run --rm -v $(pwd)/offline-packages:/download ubuntu:20.04 bash -c "
            echo '正在更新 apt 源...' && \
            apt-get update && \
            echo '正在下载 jq 及其全量依赖...' && \
            apt-get install -y --reinstall --download-only \
            -o Dir::Cache::archives=/download \
            jq"

          echo "下载完成。文件列表："
          ls -lh ./offline-packages

      - name: Upload packages
        uses: actions/upload-artifact@v4
        with:
          name: jq-offline-bundle-20.04
          path: ./offline-packages/*.deb
          retention-days: 1
