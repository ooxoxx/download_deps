name: Build and Download Blackboxprotobuf

on:
  workflow_dispatch:

jobs:
  build-and-pack:
    runs-on: windows-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          architecture: 'x64'

      - name: Install Build Tools
        # 安装 wheel 包，确保 pip 有能力打包
        run: pip install --upgrade pip wheel setuptools

      - name: Create Directory
        run: mkdir offline_wheels

      - name: Build Wheels for Windows
        # 核心修改：使用 pip wheel
        # 1. 自动下载 blackboxprotobuf 源码
        # 2. 在当前环境(Win+Py3.10)编译成 whl
        # 3. 自动下载所有依赖的 whl (protobuf 等)
        run: |
          pip wheel blackboxprotobuf `
            --wheel-dir offline_wheels `
            --prefer-binary

      - name: Verify Content
        # 验证一下生成了什么，方便调试
        run: dir offline_wheels

      - name: Upload Wheels as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: blackboxprotobuf-compiled-win10-py310
          path: offline_wheels/
          retention-days: 5
