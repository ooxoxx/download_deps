name: Build and Download Blackboxprotobuf

on:
  workflow_dispatch:

jobs:
  build-and-pack:
    runs-on: windows-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          architecture: 'x64'

      - name: Install Build Tools
        # 核心修正：使用 python -m 避免 Windows 文件锁定错误
        run: python -m pip install --upgrade pip wheel setuptools

      - name: Create Directory
        run: mkdir offline_wheels

      - name: Build Wheels for Windows
        # 使用 pip wheel 自动下载源码并编译
        # --wheel-dir: 输出目录
        # --prefer-binary: 优先用现成的whl(如果有的话)
        run: |
          pip wheel blackboxprotobuf `
            --wheel-dir offline_wheels `
            --prefer-binary

      - name: Verify Content
        # 看看下载了什么，方便确认
        run: dir offline_wheels

      - name: Upload Wheels as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: blackboxprotobuf-compiled-win10-py310
          path: offline_wheels/
          retention-days: 5
